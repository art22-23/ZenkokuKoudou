<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ドキュメンタリー映画「金福童」特設サイト</title>
  <style>
    /* リセット */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* 背景画像の設定 */
    body {
      font-family: 'Arial', sans-serif;
      background-image: url('poster.png'); /* 任意の背景画像URLに置き換えてください */
      background-size: cover;
      background-attachment: fixed;
      background-repeat: no-repeat;
      color: #333;
      line-height: 1.6;
      scroll-behavior: smooth;
    }

    /* ヘッダー */
    header {
      background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)),
                  url('https://example.com/path/to/your/header.jpg') no-repeat center center;
      background-size: cover;
      color: #fff;
      padding: 20px 0;
      text-align: center;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 100;
    }
    header h1 {
      font-size: 2em;
      margin-bottom: 10px;
    }
    nav a {
      color: #fff;
      margin: 0 12px;
      text-decoration: none;
      transition: color 0.3s;
    }
    nav a:hover {
      color: #ffd700;
    }

    /* コンテナ */
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 100px 20px 40px 20px; /* ヘッダー分の余白を確保 */
    }

    /* セクション */
    section {
      scroll-margin-top: 120px;
      background: #fff;
      margin-bottom: 50px;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 1s forwards;
    }
    section:nth-of-type(1) { animation-delay: 0.2s; }
    section:nth-of-type(2) { animation-delay: 0.4s; }
    section:nth-of-type(3) { animation-delay: 0.6s; }
    section:nth-of-type(4) { animation-delay: 0.8s; }
    section:nth-of-type(5) { animation-delay: 1s; }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    h2 {
      margin-bottom: 15px;
      border-bottom: 2px solid #ffd700;
      padding-bottom: 5px;
    }

    /* 上映情報テーブル */
    .screenings table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    .screenings th, .screenings td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }

    /* detailsスタイル */
    details {
      margin-top: 10px;
    }
    summary {
      cursor: pointer;
      font-weight: bold;
      padding: 10px;
      background: #ffd700;
      border-radius: 3px;
    }

    /* 予告編 */
    .trailers iframe {
      width: 100%;
      height: 315px;
      border: none;
      margin-bottom: 20px;
      transition: transform 0.3s;
    }
    .trailers iframe:hover {
      transform: scale(1.05);
    }

    /* 視聴者の感想 */
    .feedback ul {
      list-style: none;
      margin-top: 10px;
    }
    .feedback li {
      background: #f9f9f9;
      padding: 10px;
      margin-bottom: 8px;
      border-left: 4px solid #ffd700;
    }

    /* 自主上映勧誘 */
    .invite {
      text-align: center;
      background: #ffd700;
      padding: 20px;
      border-radius: 5px;
      font-size: 1.2em;
    }
    .invite a {
      color: #333;
      text-decoration: none;
      font-weight: bold;
      border-bottom: 2px solid #333;
      transition: color 0.3s, border-color 0.3s;
    }
    .invite a:hover {
      color: #000;
      border-color: #000;
    }
    .apply-link {
      display: inline-block;
      margin-top: 15px;
      padding: 10px 20px;
      background: #555;
      color: #fff;
      text-decoration: none;
      border-radius: 5px;
      transition: background 0.3s;
    }
    .apply-link:hover {
      background: #555;
    }

    /* エラーメッセージ */
    .error-message {
      background-color: #ffdddd;
      border-left: 6px solid #f44336;
      margin-bottom: 15px;
      padding: 10px;
      color: #333;
    }
  </style>
</head>
<body>
  <header>
    <h1>ドキュメンタリー映画「金福童」特設サイトtest3</h1>
    <nav>
      <a href="#upcoming">今後の上映情報</a>
      <a href="#past">過去の上映情報</a>
      <a href="#info">映画情報</a>
      <a href="#trailers">予告編</a>
      <a href="#feedback">視聴者の感想</a>
      <a href="#invite">自主上映勧誘</a>
    </nav>
  </header>

  <div class="container">
    <!-- React による上映情報の表示 -->
    <div id="screenings-root"></div>

    <!-- その他の静的コンテンツ -->
    <section id="info">
      <h2>映画について</h2>
      <p>本作は、日本軍「慰安婦」被害者である金福童さんの人生を描いた作品です。</p>
      <p>日本軍の性奴隷とされた金福童さんが1992年の名乗り出以降、問題の解決を訴えながら出会いを重ね、社会の不条理に苦しむ人々を励まし、手を取ってともに歩む姿が描かれています。2019年1月、金福童さんが亡くなられ、その生を多くの人に知ってもらおうとドキュメンタリー映画「金福童」が製作されました。私たちはこの映画をぜひ多くの日本の皆さんにも見てほしいと考え、全国各地での上映を進めています。金福童さんの生き方に共感し、感動した、勇気と希望をもらったという多くの声が届いています。</p>
      <p>監督：宋元根 （ソン・ウォングン）| 制作年：2019年 |制作会社：ニュースタパ |上映時間：101分  </p>
      <!-- 以下、続く紹介文など -->
    </section>
    <!-- 予告編、視聴者の感想、自主上映勧誘等の静的セクションをここに配置 -->
  </div>

  <!-- 必要な外部ライブラリの読み込み -->
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

  <!-- CSVデータの読み込みとReactレンダリング用スクリプト -->
  <script type="text/babel">
    const { useState, useEffect } = React;

    const ScreeningsComponent = () => {
      const [upcomingScreenings, setUpcomingScreenings] = useState([]);
      const [pastScreenings, setPastScreenings] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [regionMap, setRegionMap] = useState({});

      // 日付をYYYY/MM/DD形式に変換するヘルパー関数
      const formatDate = (dateStr) => {
        const date = new Date(dateStr);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}/${month}/${day}`;
      };

      // 地域別に上映情報をグループ化する関数
      const groupByRegion = (screenings) => {
        const grouped = {};
        screenings.forEach(screening => {
          const city = screening.city || '';
          const region = regionMap[city] || '未分類';
          if (!grouped[region]) {
            grouped[region] = [];
          }
          grouped[region].push(screening);
        });
        // 地域の順序を指定
        const regionOrder = ['北海道', '東北', '関東', '中部', '近畿', '中国', '四国', '九州', '沖縄', '未分類'];
        return regionOrder
          .filter(region => grouped[region] && grouped[region].length > 0)
          .map(region => ({
            region,
            screenings: grouped[region]
          }));
      };

      // CSVデータを読み込む副作用処理
      useEffect(() => {
        const fetchData = async () => {
          try {
            // fetch()でCSVファイルを取得
            const screeningsResponse = await fetch('screenings.csv').then(res => res.text());
            const regionsResponse = await fetch('regions.csv').then(res => res.text());

            // 地域マッピングCSVの解析
            const regionData = Papa.parse(regionsResponse, {
              header: true,
              skipEmptyLines: true
            });
            const regionMapping = {};
            regionData.data.forEach(row => {
              if (row.city && row.region) {
                regionMapping[row.city] = row.region;
              }
            });
            setRegionMap(regionMapping);

            // 上映情報CSVの解析
            const result = Papa.parse(screeningsResponse, {
              header: true,
              skipEmptyLines: true,
              dynamicTyping: true,
              transformHeader: header => header.trim(),
              transform: (value, field) => {
                if (field === 'date' && value) {
                  return formatDate(value);
                }
                return value;
              }
            });

            if (result.errors.length > 0) {
              console.error('CSV解析エラー:', result.errors);
              setError('データの読み込み中にエラーが発生しました。');
            } else {
              // 日付順にソート
              const now = new Date();
              const sortedData = result.data.sort((a, b) => {
                const dateA = new Date(a.date.split('/').join('-'));
                const dateB = new Date(b.date.split('/').join('-'));
                return dateA - dateB;
              });
              // 今後と過去の上映情報に振り分け
              const upcoming = [];
              const past = [];
              sortedData.forEach(screening => {
                const screeningDate = new Date(screening.date.split('/').join('-'));
                if (screeningDate >= now) {
                  upcoming.push(screening);
                } else {
                  past.push(screening);
                }
              });
              setUpcomingScreenings(upcoming);
              setPastScreenings(past);
            }
          } catch (err) {
            console.error('データ読み込み中エラー:', err);
            setError('データの読み込み中にエラーが発生しました。');
          } finally {
            setLoading(false);
          }
        };

        fetchData();
      }, []);

      if (loading) {
        return <div>データを読み込み中...</div>;
      }

      if (error) {
        return <div className="error-message">{error}</div>;
      }

      return (
        <div>
          {/* 今後の上映情報 */}
          <section id="upcoming" className="screenings">
            <h2>今後の上映情報</h2>
            {upcomingScreenings.length === 0 ? (
              <p>現在予定されている上映情報はありません。</p>
            ) : (
              <table>
                <thead>
                  <tr>
                    <th>日付</th>
                    <th>時間</th>
                    <th>会場</th>
                    <th>主催</th>
                    <th>リンク</th>
                  </tr>
                </thead>
                <tbody>
                  {upcomingScreenings.map((screening, index) => (
                    <tr key={index}>
                      <td>{screening.date}</td>
                      <td>{screening.time || '-'}</td>
                      <td>{screening.venue || '-'}</td>
                      <td>{screening.organizer || '-'}</td>
                      <td>
                        {screening.link ? (
                          <a href={screening.link} target="_blank" rel="noopener noreferrer">詳細</a>
                        ) : (
                          '-'
                        )}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            )}
          </section>

          {/* 過去の上映情報 */}
          <section id="past" className="screenings">
            <h2>過去の上映情報</h2>
            <details>
              <summary>過去の上映情報を表示する</summary>
              {groupByRegion(pastScreenings).map(({ region, screenings }) => (
                <div key={region}>
                  <h3>{region}</h3>
                  <table>
                    <thead>
                      <tr>
                        <th>日付</th>
                        <th>開催地</th>
                        <th>会場</th>
                        <th>主催</th>
                        <th>報告</th>
                      </tr>
                    </thead>
                    <tbody>
                      {screenings.map((screening, index) => (
                        <tr key={index}>
                          <td>{screening.date}</td>
                          <td>{screening.city || '-'}</td>
                          <td>{screening.venue || '-'}</td>
                          <td>{screening.organizer || '-'}</td>
                          <td>
                            {screening.report_link ? (
                              <a href={screening.report_link} target="_blank" rel="noopener noreferrer">報告を見る</a>
                            ) : (
                              '-'
                            )}
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              ))}
            </details>
          </section>
        </div>
      );
    };

    // React 18の場合
    if (ReactDOM.createRoot) {
      const root = ReactDOM.createRoot(document.getElementById('screenings-root'));
      root.render(<ScreeningsComponent />);
    } else {
      // React 17以前
      ReactDOM.render(<ScreeningsComponent />, document.getElementById('screenings-root'));
    }
  </script>
</body>
</html>
